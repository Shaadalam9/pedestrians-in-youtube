#############################################
# GitHub Actions Workflow: Lint codebase
#
# What it does:
# - Runs Super-Linter on pushes and pull requests.
# - Uses linter config files stored under .github/linters
# - Lints only changed files (faster) unless you flip VALIDATE_ALL_CODEBASE.
#
# Why this version:
# - super-linter/super-linter is the maintained action (v8+).
#############################################

name: Lint codebase

on:
  # Run on any push to any branch
  push:

  # Run on PRs targeting main
  pull_request:
    branches: [main]

#############################################
# Permissions
# - contents: read  => checkout repo
# - packages: read  => pull the container image
# - statuses: write => report status checks back to GitHub
#############################################
permissions:
  contents: read
  packages: read
  statuses: write

jobs:
  lint:
    name: Lint codebase
    runs-on: ubuntu-latest

    steps:
      #########################################
      # Checkout code
      # fetch-depth: 0 is important so Super-Linter
      # can compute a correct diff when linting
      # only changed files.
      #########################################
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      #########################################
      # Run Super-Linter
      #########################################
      - name: Run Super-Linter
        uses: super-linter/super-linter@v8.3.2
        env:
          # Required for status checks
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # Only lint files changed in the PR/push (recommended for speed)
          VALIDATE_ALL_CODEBASE: false

          # Your repository default branch
          DEFAULT_BRANCH: main

          # Filter what files Super-Linter will consider
          FILTER_REGEX_INCLUDE: ".*"
          FILTER_REGEX_EXCLUDE: "(README\\.md|figures/.*)"

          # Where your linter config files live
          LINTER_RULES_PATH: .github/linters

          # JSCPD config filename (resolved inside LINTER_RULES_PATH)
          JSCPD_CONFIG_FILE: .jscpd.json

          # Optional: keep these disabled if you don't want them enforced here
          VALIDATE_PYTHON_BLACK: false
          VALIDATE_PYTHON_ISORT: false
