---
################################
# Super-Linter GitHub Workflow  #
################################
name: Lint codebase

on:
  push:
    # If you want to avoid running on pushes to main, uncomment:
    # branches-ignore:
    #   - main
  pull_request:
    branches:
      - main

# Minimum permissions Super-Linter typically needs to create status checks.
permissions:
  contents: read
  statuses: write
  pull-requests: read

jobs:
  super-linter:
    name: Lint codebase
    runs-on: ubuntu-latest

    steps:
      # Checkout is required so Super-Linter can compute changed files when
      # VALIDATE_ALL_CODEBASE=false.
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Full git history is needed to correctly determine changed files
          # for PRs and push events.
          fetch-depth: 0

      - name: Run Super-Linter
        uses: super-linter/super-linter@v8.3.2
        env:
          # Required
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # Super-Linter behavior
          DEFAULT_BRANCH: main
          VALIDATE_ALL_CODEBASE: false

          # File filtering:
          # - INCLUDE everything by default
          # - EXCLUDE documentation, templates, and generated artifacts
          #
          # Notes:
          # - Templates are commonly stored in:
          #   - templates/
          #   - .github/ISSUE_TEMPLATE/
          #   - .github/PULL_REQUEST_TEMPLATE.md
          # - Generated artifacts in your logs are under figures/ and can be very large.
          FILTER_REGEX_INCLUDE: ".*"
          FILTER_REGEX_EXCLUDE: '(^README\.md$|^templates/|^\.github/ISSUE_TEMPLATE/|^\.github/PULL_REQUEST_TEMPLATE\.md$|^figures/|^mapping_metadata\.csv$)'

          # Ensure Super-Linter uses configs from .github/linters
          LINTER_RULES_PATH: .github/linters

          # Ensure JSCPD reads this config filename from LINTER_RULES_PATH
          JSCPD_CONFIG_FILE: .jscpd.json

          # Keep your existing Python formatter choices
          VALIDATE_PYTHON_BLACK: false
          VALIDATE_PYTHON_ISORT: false

          # Biome is currently failing because it lints large generated HTML files and
          # you are also seeing Biome/Prettier conflict warnings. Disable unless you
          # explicitly want Biome for JS/TS/CSS in this repo.
          VALIDATE_BIOME_FORMAT: false
          VALIDATE_BIOME_LINT: false

          # Optional: suppress commitlint warning if you do not use it
          # VALIDATE_GIT_COMMITLINT: false

          # Trivy is currently FAILING due to vulnerabilities in uv.lock.
          # Choose ONE approach below:
          #
          # A) Recommended for green CI now: move dependency/security scanning to a dedicated
          #    security workflow and disable Trivy here:
          # VALIDATE_TRIVY: false
          #
          # B) Keep Trivy here and fix the underlying vulnerabilities by upgrading deps
          #    (see guidance below).
