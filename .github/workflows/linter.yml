---
################################
# Super-Linter GitHub Workflow  #
################################
name: Lint codebase

on:
  push:
    # If you want to avoid running on pushes to main, uncomment:
    # branches-ignore:
    #   - main
  pull_request:
    branches:
      - main

# Minimum permissions Super-Linter typically needs to create status checks.
permissions:
  contents: read
  statuses: write
  pull-requests: read

jobs:
  super-linter:
    name: Lint codebase
    runs-on: ubuntu-latest

    steps:
      # Checkout is required so Super-Linter can compute changed files when
      # VALIDATE_ALL_CODEBASE=false.
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Full git history is needed to correctly determine changed files
          # for PRs and push events.
          fetch-depth: 0

      - name: Run Super-Linter
        uses: super-linter/super-linter@v8.3.2
        env:
          # Required
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # Super-Linter behavior
          DEFAULT_BRANCH: main
          VALIDATE_ALL_CODEBASE: false

          # Option A: Save linter outputs to files so we can inspect CHECKOV/ZIZMOR findings
          SAVE_SUPER_LINTER_OUTPUT: true
          CREATE_LOG_FILE: true

          # File filtering:
          # - INCLUDE everything by default
          # - EXCLUDE documentation, templates, and generated artifacts
          FILTER_REGEX_INCLUDE: ".*"
          FILTER_REGEX_EXCLUDE: '(^README\.md$|^templates/|^\.github/ISSUE_TEMPLATE/|^\.github/PULL_REQUEST_TEMPLATE\.md$|^figures/|^mapping_metadata\.csv$)'

          # Ensure Super-Linter uses configs from .github/linters
          LINTER_RULES_PATH: .github/linters

          # Ensure JSCPD reads this config filename from LINTER_RULES_PATH
          JSCPD_CONFIG_FILE: .jscpd.json

          # Keep your existing Python formatter choices
          VALIDATE_PYTHON_BLACK: false
          VALIDATE_PYTHON_ISORT: false

          # Disable Biome unless you explicitly want it
          VALIDATE_BIOME_FORMAT: false
          VALIDATE_BIOME_LINT: false

          # Optional: suppress commitlint warning if you do not use it
          # VALIDATE_GIT_COMMITLINT: false

          # Trivy note (keep as-is unless you decide otherwise):
          # VALIDATE_TRIVY: false

      - name: Upload Super-Linter output
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: super-linter-output
          path: |
            super-linter-output
            super-linter.log
          if-no-files-found: warn
