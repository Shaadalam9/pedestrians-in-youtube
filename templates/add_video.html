<!doctype html>
<html lang="en">
<head>
    <title>Add dashcam video</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        .container {
            display: flex;
            justify-content: space-between;
        }
        .left, .right {
            width: 48%;
        }
        .left {
            padding: 15px;
/*            height: 90vh;*/
            overflow-y: auto;
        }
        .right {
            width: 48%;
        }
        .videos-text {
            word-wrap: break-word;
            white-space: normal;
            flex: 1;
            font-size: 14px;
            margin-right: 10px;
            line-height: 1.2; /* adjust line spacing */
            padding: 2px 0;   /* reduce top/bottom padding */
            margin: 0;        /* remove extra margin */
            overflow: hidden; /* prevent text overflow */
        }
        .message {
            color: green;
            margin-top: 20px;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .form-container h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 2px;
        }
        .form-group label {
            flex: 1;
            font-size: 16px;
            margin-right: 10px;
        }
        .form-group input,
        .form-group select {
            flex: 2;
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        .form-group input[type="text"] {
            text-align: left;
        }
        .form-group select {
            background-color: #fff;
        }
        .form-group button {
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-group button:hover {
            background-color: #0056b3;
        }

        #embeddedVideo {
            width: 100%;
            height: 50%;
            max-height: 500px;
        }

        #map {
            width: 100%;
            height: 40%; /* ensure height is explicitly set */
            max-height: 400px;
        }

        .short_row {
            line-height: 1.2; /* adjust line spacing */
            padding: 2px 0;   /* reduce top/bottom padding */
            margin: 0;        /* remove extra margin */
            font-size: 16px;  /* adjust font size if needed */
            overflow: hidden; /* prevent text overflow */
/*            max-height: 20px; /* optional: limit max height */*/
        }

        #currentTime {
            color: red;
        }
    </style>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player; // global youtube player variable

        function onYouTubeIframeAPIReady() {
            console.log("YouTube API Ready");
            initializePlayer();
        }

        function initializePlayer() {
            const videoElement = document.getElementById('embeddedVideo');

            // check if the iframe exists and has the correct API enabled
            if (videoElement) {
                player = new YT.Player('embeddedVideo', {
                    events: {
                        'onReady': function() {
                            console.log("YouTube Player Ready");
                            updateCurrentTime();
                        },
                        'onStateChange': onPlayerStateChange
                    }
                });
            }
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                updateCurrentTime();
            }
        }

        function updateCurrentTime() {
            if (player && player.getCurrentTime) {
                let timeDisplay = document.getElementById('currentTime');
                if (timeDisplay) {
                    timeDisplay.textContent = Math.floor(player.getCurrentTime());
                }
                setTimeout(updateCurrentTime, 1000);
            }
        }

        // Wait for the DOM to fully load
        document.addEventListener('DOMContentLoaded', function() {
            const fetchDataButton = document.getElementById('fetchDataButton');
            const embeddedVideo = document.getElementById('embeddedVideo');

            fetchDataButton.addEventListener('click', function () {
                fetch('/fetch_video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.video_id) {
                        console.log("New video fetched:", data.video_id);
                        embeddedVideo.src = `https://www.youtube.com/embed/${data.video_id}?enablejsapi=1&autoplay=1&mute=1`;

                        // wait for iframe to load before re-initializing player
                        embeddedVideo.onload = function () {
                            console.log("Iframe loaded, reinitializing player");
                            initializePlayer(); // reinitialize player after fetching new video
                        };
                    } else {
                        alert('Failed to fetch video.');
                    }
                })
                .catch(error => console.error('Error:', error));
            });

            // if the iframe already exists, initialize player immediately
            if (typeof YT !== 'undefined' && YT.Player) {
                initializePlayer();
            }
            
            let lat = parseFloat("{{ existing_data['lat'] or 52.3676 }}");
            let lon = parseFloat("{{ existing_data['lon'] or 4.9041 }}");

            let mapElement = document.getElementById("map");
            let latInput = document.getElementById("lat");
            let lonInput = document.getElementById("lon");

            if (mapElement && latInput && lonInput) {
                console.log("Initializing map at:", lat, lon);

                let map = L.map("map").setView([lat, lon], 13);

                L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                    attribution: "&copy; OpenStreetMap contributors",
                    detectRetina: true,
                    maxZoom: 18,
                }).addTo(map);

                let marker = L.marker([lat, lon], { draggable: true }).addTo(map);

                // update input fields when marker is dragged
                marker.on("dragend", function(event) {
                    let position = marker.getLatLng();
                    latInput.value = position.lat.toFixed(6);
                    lonInput.value = position.lng.toFixed(6);
                    console.log("Updated position:", position.lat, position.lng);
                });

                // update marker if user manually changes lat/lon in the inputs
                function updateMarkerPosition() {
                    let newLat = parseFloat(latInput.value);
                    let newLon = parseFloat(lonInput.value);
                    if (!isNaN(newLat) && !isNaN(newLon)) {
                        marker.setLatLng([newLat, newLon]);
                        map.setView([newLat, newLon], 13);
                    }
                }

                latInput.addEventListener("change", updateMarkerPosition);
                lonInput.addEventListener("change", updateMarkerPosition);
            } else {
                console.error("Map element or input fields not found!");
            }

        });
    </script>
</head>
<body>
    <div class="container">
        <div class="left">
            <form method="POST">
                <div class="form-group">
                    <label for="city">City:</label>
                    <input type="text" id="city" name="city" value="{{ city }}" required>
                </div>

                <div class="form-group">
                    <label for="state">State (optional):</label>
                    <input type="text" id="state" name="state" value="{{ state }}">
                </div>

                <div class="form-group">
                    <label for="country">Country:</label>
                    <!-- <input type="text" id="country" name="country" value="{{ country }}" required> -->
                    <select id="country" name="country" value="{{ country }}" required name="country">
                        <option value="">Select a country</option>
                        <option value="Afghanistan" {{ "selected" if country == "Afghanistan" else "" }}>ğŸ‡¦ğŸ‡« Afghanistan</option>
                        <option value="Albania" {{ "selected" if country == "Albania" else "" }}>ğŸ‡¦ğŸ‡± Albania</option>
                        <option value="Algeria" {{ "selected" if country == "Algeria" else "" }}>ğŸ‡©ğŸ‡¿ Algeria</option>
                        <option value="Andorra" {{ "selected" if country == "Andorra" else "" }}>ğŸ‡¦ğŸ‡© Andorra</option>
                        <option value="Angola" {{ "selected" if country == "Angola" else "" }}>ğŸ‡¦ğŸ‡´ Angola</option>
                        <option value="Antigua and Barbuda" {{ "selected" if country == "Antigua and Barbuda" else "" }}>ğŸ‡¦ğŸ‡¬ Antigua and Barbuda</option>
                        <option value="Argentina" {{ "selected" if country == "Argentina" else "" }}>ğŸ‡¦ğŸ‡· Argentina</option>
                        <option value="Armenia" {{ "selected" if country == "Armenia" else "" }}>ğŸ‡¦ğŸ‡² Armenia</option>
                        <option value="Australia" {{ "selected" if country == "Australia" else "" }}>ğŸ‡¦ğŸ‡º Australia</option>
                        <option value="Austria" {{ "selected" if country == "Austria" else "" }}>ğŸ‡¦ğŸ‡¹ Austria</option>
                        <option value="Azerbaijan" {{ "selected" if country == "Azerbaijan" else "" }}>ğŸ‡¦ğŸ‡¿ Azerbaijan</option>
                        <option value="Bahamas" {{ "selected" if country == "Bahamas" else "" }}>ğŸ‡§ğŸ‡¸ Bahamas</option>
                        <option value="Bahrain" {{ "selected" if country == "Bahrain" else "" }}>ğŸ‡§ğŸ‡­ Bahrain</option>
                        <option value="Bangladesh" {{ "selected" if country == "Bangladesh" else "" }}>ğŸ‡§ğŸ‡© Bangladesh</option>
                        <option value="Barbados" {{ "selected" if country == "Barbados" else "" }}>ğŸ‡§ğŸ‡§ Barbados</option>
                        <option value="Belarus" {{ "selected" if country == "Belarus" else "" }}>ğŸ‡§ğŸ‡¾ Belarus</option>
                        <option value="Belgium" {{ "selected" if country == "Belgium" else "" }}>ğŸ‡§ğŸ‡ª Belgium</option>
                        <option value="Belize" {{ "selected" if country == "Belize" else "" }}>ğŸ‡§ğŸ‡¿ Belize</option>
                        <option value="Benin" {{ "selected" if country == "Benin" else "" }}>ğŸ‡§ğŸ‡¯ Benin</option>
                        <option value="Bhutan" {{ "selected" if country == "Bhutan" else "" }}>ğŸ‡§ğŸ‡¹ Bhutan</option>
                        <option value="Bolivia" {{ "selected" if country == "Bolivia" else "" }}>ğŸ‡§ğŸ‡´ Bolivia</option>
                        <option value="Bosnia and Herzegovina" {{ "selected" if country == "Bosnia and Herzegovina" else "" }}>ğŸ‡§ğŸ‡¦ Bosnia and Herzegovina</option>
                        <option value="Botswana" {{ "selected" if country == "Botswana" else "" }}>ğŸ‡§ğŸ‡¼ Botswana</option>
                        <option value="Brazil" {{ "selected" if country == "Brazil" else "" }}>ğŸ‡§ğŸ‡· Brazil</option>
                        <option value="Brunei" {{ "selected" if country == "Brunei" else "" }}>ğŸ‡§ğŸ‡³ Brunei</option>
                        <option value="Bulgaria" {{ "selected" if country == "Bulgaria" else "" }}>ğŸ‡§ğŸ‡¬ Bulgaria</option>
                        <option value="Burkina Faso" {{ "selected" if country == "Burkina Faso" else "" }}>ğŸ‡§ğŸ‡« Burkina Faso</option>
                        <option value="Burundi" {{ "selected" if country == "Burundi" else "" }}>ğŸ‡§ğŸ‡® Burundi</option>
                        <option value="Cabo Verde" {{ "selected" if country == "Cabo Verde" else "" }}>ğŸ‡¨ğŸ‡» Cabo Verde</option>
                        <option value="Cambodia" {{ "selected" if country == "Cambodia" else "" }}>ğŸ‡°ğŸ‡­ Cambodia</option>
                        <option value="Cameroon" {{ "selected" if country == "Cameroon" else "" }}>ğŸ‡¨ğŸ‡² Cameroon</option>
                        <option value="Canada" {{ "selected" if country == "Canada" else "" }}>ğŸ‡¨ğŸ‡¦ Canada</option>
                        <option value="Central African Republic" {{ "selected" if country == "Central African Republic" else "" }}>ğŸ‡¨ğŸ‡« Central African Republic</option>
                        <option value="Chad" {{ "selected" if country == "Chad" else "" }}>ğŸ‡¹ğŸ‡© Chad</option>
                        <option value="Chile" {{ "selected" if country == "Chile" else "" }}>ğŸ‡¨ğŸ‡± Chile</option>
                        <option value="China" {{ "selected" if country == "China" else "" }}>ğŸ‡¨ğŸ‡³ China</option>
                        <option value="Colombia" {{ "selected" if country == "Colombia" else "" }}>ğŸ‡¨ğŸ‡´ Colombia</option>
                        <option value="Comoros" {{ "selected" if country == "Comoros" else "" }}>ğŸ‡°ğŸ‡² Comoros</option>
                        <option value="Congo (Congo-Brazzaville)" {{ "selected" if country == "Congo (Congo-Brazzaville)" else "" }}>ğŸ‡¨ğŸ‡¬ Congo (Congo-Brazzaville)</option>
                        <option value="Congo (Democratic Republic of the Congo)" {{ "selected" if country == "Congo (Democratic Republic of the Congo)" else "" }}>ğŸ‡¨ğŸ‡© Congo (Democratic Republic of the Congo)</option>
                        <option value="Costa Rica" {{ "selected" if country == "Costa Rica" else "" }}>ğŸ‡¨ğŸ‡· Costa Rica</option>
                        <option value="Croatia" {{ "selected" if country == "Croatia" else "" }}>ğŸ‡­ğŸ‡· Croatia</option>
                        <option value="Cuba" {{ "selected" if country == "Cuba" else "" }}>ğŸ‡¨ğŸ‡º Cuba</option>
                        <option value="Cyprus" {{ "selected" if country == "Cyprus" else "" }}>ğŸ‡¨ğŸ‡¾ Cyprus</option>
                        <option value="Czech Republic" {{ "selected" if country == "Czech Republic" else "" }}>ğŸ‡¨ğŸ‡¿ Czech Republic</option>
                        <option value="Denmark" {{ "selected" if country == "Denmark" else "" }}>ğŸ‡©ğŸ‡° Denmark</option>
                        <option value="Djibouti" {{ "selected" if country == "Djibouti" else "" }}>ğŸ‡©ğŸ‡¯ Djibouti</option>
                        <option value="Dominica" {{ "selected" if country == "Dominica" else "" }}>ğŸ‡©ğŸ‡² Dominica</option>
                        <option value="Dominican Republic" {{ "selected" if country == "Dominican Republic" else "" }}>ğŸ‡©ğŸ‡´ Dominican Republic</option>
                        <option value="Ecuador" {{ "selected" if country == "Ecuador" else "" }}>ğŸ‡ªğŸ‡¨ Ecuador</option>
                        <option value="Egypt" {{ "selected" if country == "Egypt" else "" }}>ğŸ‡ªğŸ‡¬ Egypt</option>
                        <option value="El Salvador" {{ "selected" if country == "El Salvador" else "" }}>ğŸ‡¸ğŸ‡» El Salvador</option>
                        <option value="Equatorial Guinea" {{ "selected" if country == "Equatorial Guinea" else "" }}>ğŸ‡¬ğŸ‡¶ Equatorial Guinea</option>
                        <option value="Eritrea" {{ "selected" if country == "Eritrea" else "" }}>ğŸ‡ªğŸ‡· Eritrea</option>
                        <option value="Estonia" {{ "selected" if country == "Estonia" else "" }}>ğŸ‡ªğŸ‡ª Estonia</option>
                        <option value="Eswatini" {{ "selected" if country == "Eswatini" else "" }}>ğŸ‡¸ğŸ‡¿ Eswatini</option>
                        <option value="Ethiopia" {{ "selected" if country == "Ethiopia" else "" }}>ğŸ‡ªğŸ‡¹ Ethiopia</option>
                        <option value="Fiji" {{ "selected" if country == "Fiji" else "" }}>ğŸ‡«ğŸ‡¯ Fiji</option>
                        <option value="Finland" {{ "selected" if country == "Finland" else "" }}>ğŸ‡«ğŸ‡® Finland</option>
                        <option value="France" {{ "selected" if country == "France" else "" }}>ğŸ‡«ğŸ‡· France</option>
                        <option value="Gabon" {{ "selected" if country == "Gabon" else "" }}>ğŸ‡¬ğŸ‡¦ Gabon</option>
                        <option value="Gambia" {{ "selected" if country == "Gambia" else "" }}>ğŸ‡¬ğŸ‡² Gambia</option>
                        <option value="Georgia" {{ "selected" if country == "Georgia" else "" }}>ğŸ‡¬ğŸ‡ª Georgia</option>
                        <option value="Germany" {{ "selected" if country == "Germany" else "" }}>ğŸ‡©ğŸ‡ª Germany</option>
                        <option value="Ghana" {{ "selected" if country == "Ghana" else "" }}>ğŸ‡¬ğŸ‡­ Ghana</option>
                        <option value="Greece" {{ "selected" if country == "Greece" else "" }}>ğŸ‡¬ğŸ‡· Greece</option>
                        <option value="Grenada" {{ "selected" if country == "Grenada" else "" }}>ğŸ‡¬ğŸ‡© Grenada</option>
                        <option value="Guatemala" {{ "selected" if country == "Guatemala" else "" }}>ğŸ‡¬ğŸ‡¹ Guatemala</option>
                        <option value="Guinea" {{ "selected" if country == "Guinea" else "" }}>ğŸ‡¬ğŸ‡³ Guinea</option>
                        <option value="Guinea-Bissau" {{ "selected" if country == "Guinea-Bissau" else "" }}>ğŸ‡¬ğŸ‡¼ Guinea-Bissau</option>
                        <option value="Guyana" {{ "selected" if country == "Guyana" else "" }}>ğŸ‡¬ğŸ‡¾ Guyana</option>
                        <option value="Haiti" {{ "selected" if country == "Haiti" else "" }}>ğŸ‡­ğŸ‡¹ Haiti</option>
                        <option value="Honduras" {{ "selected" if country == "Honduras" else "" }}>ğŸ‡­ğŸ‡³ Honduras</option>
                        <option value="Hungary" {{ "selected" if country == "Hungary" else "" }}>ğŸ‡­ğŸ‡º Hungary</option>
                        <option value="Iceland" {{ "selected" if country == "Iceland" else "" }}>ğŸ‡®ğŸ‡¸ Iceland</option>
                        <option value="India" {{ "selected" if country == "India" else "" }}>ğŸ‡®ğŸ‡³ India</option>
                        <option value="Indonesia" {{ "selected" if country == "Indonesia" else "" }}>ğŸ‡®ğŸ‡© Indonesia</option>
                        <option value="Iran" {{ "selected" if country == "Iran" else "" }}>ğŸ‡®ğŸ‡· Iran</option>
                        <option value="Iraq" {{ "selected" if country == "Iraq" else "" }}>ğŸ‡®ğŸ‡¶ Iraq</option>
                        <option value="Ireland" {{ "selected" if country == "Ireland" else "" }}>ğŸ‡®ğŸ‡ª Ireland</option>
                        <option value="Israel" {{ "selected" if country == "Israel" else "" }}>ğŸ‡®ğŸ‡± Israel</option>
                        <option value="Italy" {{ "selected" if country == "Italy" else "" }}>ğŸ‡®ğŸ‡¹ Italy</option>
                        <option value="Jamaica" {{ "selected" if country == "Jamaica" else "" }}>ğŸ‡¯ğŸ‡² Jamaica</option>
                        <option value="Japan" {{ "selected" if country == "Japan" else "" }}>ğŸ‡¯ğŸ‡µ Japan</option>
                        <option value="Jordan" {{ "selected" if country == "Jordan" else "" }}>ğŸ‡¯ğŸ‡´ Jordan</option>
                        <option value="Kazakhstan" {{ "selected" if country == "Kazakhstan" else "" }}>ğŸ‡°ğŸ‡¿ Kazakhstan</option>
                        <option value="Kenya" {{ "selected" if country == "Kenya" else "" }}>ğŸ‡°ğŸ‡ª Kenya</option>
                        <option value="Kiribati" {{ "selected" if country == "Kiribati" else "" }}>ğŸ‡°ğŸ‡® Kiribati</option>
                        <option value="Korea (North)" {{ "selected" if country == "Korea (North)" else "" }}>ğŸ‡°ğŸ‡µ Korea (North)</option>
                        <option value="Korea (South)" {{ "selected" if country == "Korea (South)" else "" }}>ğŸ‡°ğŸ‡· Korea (South)</option>
                        <option value="Kuwait" {{ "selected" if country == "Kuwait" else "" }}>ğŸ‡°ğŸ‡¼ Kuwait</option>
                        <option value="Kyrgyzstan" {{ "selected" if country == "Kyrgyzstan" else "" }}>ğŸ‡°ğŸ‡¬ Kyrgyzstan</option>
                        <option value="Laos" {{ "selected" if country == "Laos" else "" }}>ğŸ‡±ğŸ‡¸ Laos</option>
                        <option value="Latvia" {{ "selected" if country == "Latvia" else "" }}>ğŸ‡±ğŸ‡» Latvia</option>
                        <option value="Lebanon" {{ "selected" if country == "Lebanon" else "" }}>ğŸ‡±ğŸ‡§ Lebanon</option>
                        <option value="Lesotho" {{ "selected" if country == "Lesotho" else "" }}>ğŸ‡±ğŸ‡¸ Lesotho</option>
                        <option value="Liberia" {{ "selected" if country == "Liberia" else "" }}>ğŸ‡±ğŸ‡¸ Liberia</option>
                        <option value="Libya" {{ "selected" if country == "Libya" else "" }}>ğŸ‡±ğŸ‡¾ Libya</option>
                        <option value="Liechtenstein" {{ "selected" if country == "Liechtenstein" else "" }}>ğŸ‡±ğŸ‡® Liechtenstein</option>
                        <option value="Lithuania" {{ "selected" if country == "Lithuania" else "" }}>ğŸ‡±ğŸ‡¹ Lithuania</option>
                        <option value="Luxembourg" {{ "selected" if country == "Luxembourg" else "" }}>ğŸ‡±ğŸ‡º Luxembourg</option>
                        <option value="Madagascar" {{ "selected" if country == "Madagascar" else "" }}>ğŸ‡²ğŸ‡¬ Madagascar</option>
                        <option value="Malawi" {{ "selected" if country == "Malawi" else "" }}>ğŸ‡²ğŸ‡¼ Malawi</option>
                        <option value="Malaysia" {{ "selected" if country == "Malaysia" else "" }}>ğŸ‡²ğŸ‡¾ Malaysia</option>
                        <option value="Maldives" {{ "selected" if country == "Maldives" else "" }}>ğŸ‡²ğŸ‡» Maldives</option>
                        <option value="Mali" {{ "selected" if country == "Mali" else "" }}>ğŸ‡²ğŸ‡± Mali</option>
                        <option value="Malta" {{ "selected" if country == "Malta" else "" }}>ğŸ‡²ğŸ‡¹ Malta</option>
                        <option value="Marshall Islands" {{ "selected" if country == "Marshall Islands" else "" }}>ğŸ‡²ğŸ‡­ Marshall Islands</option>
                        <option value="Mauritania" {{ "selected" if country == "Mauritania" else "" }}>ğŸ‡²ğŸ‡· Mauritania</option>
                        <option value="Mauritius" {{ "selected" if country == "Mauritius" else "" }}>ğŸ‡²ğŸ‡º Mauritius</option>
                        <option value="Mexico" {{ "selected" if country == "Mexico" else "" }}>ğŸ‡²ğŸ‡½ Mexico</option>
                        <option value="Micronesia" {{ "selected" if country == "Micronesia" else "" }}>ğŸ‡«ğŸ‡² Micronesia</option>
                        <option value="Moldova" {{ "selected" if country == "Moldova" else "" }}>ğŸ‡²ğŸ‡© Moldova</option>
                        <option value="Monaco" {{ "selected" if country == "Monaco" else "" }}>ğŸ‡²ğŸ‡¨ Monaco</option>
                        <option value="Mongolia" {{ "selected" if country == "Mongolia" else "" }}>ğŸ‡²ğŸ‡³ Mongolia</option>
                        <option value="Montenegro" {{ "selected" if country == "Montenegro" else "" }}>ğŸ‡²ğŸ‡ª Montenegro</option>
                        <option value="Morocco" {{ "selected" if country == "Morocco" else "" }}>ğŸ‡²ğŸ‡¦ Morocco</option>
                        <option value="Mozambique" {{ "selected" if country == "Mozambique" else "" }}>ğŸ‡²ğŸ‡¿ Mozambique</option>
                        <option value="Myanmar (Burma)" {{ "selected" if country == "Myanmar (Burma)" else "" }}>ğŸ‡²ğŸ‡² Myanmar (Burma)</option>
                        <option value="Namibia" {{ "selected" if country == "Namibia" else "" }}>ğŸ‡³ğŸ‡¦ Namibia</option>
                        <option value="Nauru" {{ "selected" if country == "Nauru" else "" }}>ğŸ‡³ğŸ‡· Nauru</option>
                        <option value="Nepal" {{ "selected" if country == "Nepal" else "" }}>ğŸ‡³ğŸ‡µ Nepal</option>
                        <option value="Netherlands" {{ "selected" if country == "Netherlands" else "" }}>ğŸ‡³ğŸ‡± Netherlands</option>
                        <option value="New Zealand" {{ "selected" if country == "New Zealand" else "" }}>ğŸ‡³ğŸ‡¿ New Zealand</option>
                        <option value="Nicaragua" {{ "selected" if country == "Nicaragua" else "" }}>ğŸ‡³ğŸ‡® Nicaragua</option>
                        <option value="Niger" {{ "selected" if country == "Niger" else "" }}>ğŸ‡³ğŸ‡ª Niger</option>
                        <option value="Nigeria" {{ "selected" if country == "Nigeria" else "" }}>ğŸ‡³ğŸ‡¬ Nigeria</option>
                        <option value="North Macedonia" {{ "selected" if country == "North Macedonia" else "" }}>ğŸ‡²ğŸ‡° North Macedonia</option>
                        <option value="Norway" {{ "selected" if country == "Norway" else "" }}>ğŸ‡³ğŸ‡´ Norway</option>
                        <option value="Oman" {{ "selected" if country == "Oman" else "" }}>ğŸ‡´ğŸ‡² Oman</option>
                        <option value="Pakistan" {{ "selected" if country == "Pakistan" else "" }}>ğŸ‡µğŸ‡° Pakistan</option>
                        <option value="Palau" {{ "selected" if country == "Palau" else "" }}>ğŸ‡µğŸ‡¼ Palau</option>
                        <option value="Panama" {{ "selected" if country == "Panama" else "" }}>ğŸ‡µğŸ‡¦ Panama</option>
                        <option value="Papua New Guinea" {{ "selected" if country == "Papua New Guinea" else "" }}>ğŸ‡µğŸ‡¬ Papua New Guinea</option>
                        <option value="Paraguay" {{ "selected" if country == "Paraguay" else "" }}>ğŸ‡µğŸ‡¾ Paraguay</option>
                        <option value="Peru" {{ "selected" if country == "Peru" else "" }}>ğŸ‡µğŸ‡ª Peru</option>
                        <option value="Philippines" {{ "selected" if country == "Philippines" else "" }}>ğŸ‡µğŸ‡­ Philippines</option>
                        <option value="Poland" {{ "selected" if country == "Poland" else "" }}>ğŸ‡µğŸ‡± Poland</option>
                        <option value="Portugal" {{ "selected" if country == "Portugal" else "" }}>ğŸ‡µğŸ‡¹ Portugal</option>
                        <option value="Qatar" {{ "selected" if country == "Qatar" else "" }}>ğŸ‡¶ğŸ‡¦ Qatar</option>
                        <option value="Romania" {{ "selected" if country == "Romania" else "" }}>ğŸ‡·ğŸ‡´ Romania</option>
                        <option value="Russia" {{ "selected" if country == "Russia" else "" }}>ğŸ‡·ğŸ‡º Russia</option>
                        <option value="Rwanda" {{ "selected" if country == "Rwanda" else "" }}>ğŸ‡·ğŸ‡¼ Rwanda</option>
                        <option value="Saint Kitts and Nevis" {{ "selected" if country == "Saint Kitts and Nevis" else "" }}>ğŸ‡°ğŸ‡³ Saint Kitts and Nevis</option>
                        <option value="Saint Lucia" {{ "selected" if country == "Saint Lucia" else "" }}>ğŸ‡±ğŸ‡¨ Saint Lucia</option>
                        <option value="Saint Vincent and the Grenadines" {{ "selected" if country == "Saint Vincent and the Grenadines" else "" }}>ğŸ‡»ğŸ‡¨ Saint Vincent and the Grenadines</option>
                        <option value="Samoa" {{ "selected" if country == "Samoa" else "" }}>ğŸ‡¼ğŸ‡¸ Samoa</option>
                        <option value="San Marino" {{ "selected" if country == "San Marino" else "" }}>ğŸ‡¸ğŸ‡² San Marino</option>
                        <option value="Sao Tome and Principe" {{ "selected" if country == "Sao Tome and Principe" else "" }}>ğŸ‡¸ğŸ‡¹ Sao Tome and Principe</option>
                        <option value="Saudi Arabia" {{ "selected" if country == "Saudi Arabia" else "" }}>ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
                        <option value="Senegal" {{ "selected" if country == "Senegal" else "" }}>ğŸ‡¸ğŸ‡³ Senegal</option>
                        <option value="Serbia" {{ "selected" if country == "Serbia" else "" }}>ğŸ‡·ğŸ‡¸ Serbia</option>
                        <option value="Seychelles" {{ "selected" if country == "Seychelles" else "" }}>ğŸ‡¸ğŸ‡¨ Seychelles</option>
                        <option value="Sierra Leone" {{ "selected" if country == "Sierra Leone" else "" }}>ğŸ‡¸ğŸ‡± Sierra Leone</option>
                        <option value="Singapore" {{ "selected" if country == "Singapore" else "" }}>ğŸ‡¸ğŸ‡¬ Singapore</option>
                        <option value="Slovakia" {{ "selected" if country == "Slovakia" else "" }}>ğŸ‡¸ğŸ‡° Slovakia</option>
                        <option value="Slovenia" {{ "selected" if country == "Slovenia" else "" }}>ğŸ‡¸ğŸ‡® Slovenia</option>
                        <option value="Solomon Islands" {{ "selected" if country == "Solomon Islands" else "" }}>ğŸ‡¸ğŸ‡§ Solomon Islands</option>
                        <option value="Somalia" {{ "selected" if country == "Somalia" else "" }}>ğŸ‡¸ğŸ‡´ Somalia</option>
                        <option value="South Africa" {{ "selected" if country == "South Africa" else "" }}>ğŸ‡¿ğŸ‡¦ South Africa</option>
                        <option value="South Sudan" {{ "selected" if country == "South Sudan" else "" }}>ğŸ‡¸ğŸ‡¸ South Sudan</option>
                        <option value="Spain" {{ "selected" if country == "Spain" else "" }}>ğŸ‡ªğŸ‡¸ Spain</option>
                        <option value="Sri Lanka" {{ "selected" if country == "Sri Lanka" else "" }}>ğŸ‡±ğŸ‡° Sri Lanka</option>
                        <option value="Sudan" {{ "selected" if country == "Sudan" else "" }}>ğŸ‡¸ğŸ‡© Sudan</option>
                        <option value="Suriname" {{ "selected" if country == "Suriname" else "" }}>ğŸ‡¸ğŸ‡· Suriname</option>
                        <option value="Sweden" {{ "selected" if country == "Sweden" else "" }}>ğŸ‡¸ğŸ‡ª Sweden</option>
                        <option value="Switzerland" {{ "selected" if country == "Switzerland" else "" }}>ğŸ‡¨ğŸ‡­ Switzerland</option>
                        <option value="Syria" {{ "selected" if country == "Syria" else "" }}>ğŸ‡¸ğŸ‡¾ Syria</option>
                        <option value="Taiwan" {{ "selected" if country == "Taiwan" else "" }}>ğŸ‡¹ğŸ‡¼ Taiwan</option>
                        <option value="Tajikistan" {{ "selected" if country == "Tajikistan" else "" }}>ğŸ‡¹ğŸ‡¯ Tajikistan</option>
                        <option value="Tanzania" {{ "selected" if country == "Tanzania" else "" }}>ğŸ‡¹ğŸ‡¿ Tanzania</option>
                        <option value="Thailand" {{ "selected" if country == "Thailand" else "" }}>ğŸ‡¹ğŸ‡­ Thailand</option>
                        <option value="Timor-Leste" {{ "selected" if country == "Timor-Leste" else "" }}>ğŸ‡¹ğŸ‡± Timor-Leste</option>
                        <option value="Togo" {{ "selected" if country == "Togo" else "" }}>ğŸ‡¹ğŸ‡¬ Togo</option>
                        <option value="Tonga" {{ "selected" if country == "Tonga" else "" }}>ğŸ‡¹ğŸ‡´ Tonga</option>
                        <option value="Trinidad and Tobago" {{ "selected" if country == "Trinidad and Tobago" else "" }}>ğŸ‡¹ğŸ‡¹ Trinidad and Tobago</option>
                        <option value="Tunisia" {{ "selected" if country == "Tunisia" else "" }}>ğŸ‡¹ğŸ‡³ Tunisia</option>
                        <option value="Turkey" {{ "selected" if country == "Turkey" else "" }}>ğŸ‡¹ğŸ‡· Turkey</option>
                        <option value="Turkmenistan" {{ "selected" if country == "Turkmenistan" else "" }}>ğŸ‡¹ğŸ‡² Turkmenistan</option>
                        <option value="Tuvalu" {{ "selected" if country == "Tuvalu" else "" }}>ğŸ‡¹ğŸ‡» Tuvalu</option>
                        <option value="Uganda" {{ "selected" if country == "Uganda" else "" }}>ğŸ‡ºğŸ‡¬ Uganda</option>
                        <option value="Ukraine" {{ "selected" if country == "Ukraine" else "" }}>ğŸ‡ºğŸ‡¦ Ukraine</option>
                        <option value="United Arab Emirates" {{ "selected" if country == "United Arab Emirates" else "" }}>ğŸ‡¦ğŸ‡ª United Arab Emirates</option>
                        <option value="United Kingdom" {{ "selected" if country == "United Kingdom" else "" }}>ğŸ‡¬ğŸ‡§ United Kingdom</option>
                        <option value="United States" {{ "selected" if country == "United States" else "" }}>ğŸ‡ºğŸ‡¸ United States</option>
                        <option value="Uruguay" {{ "selected" if country == "Uruguay" else "" }}>ğŸ‡ºğŸ‡¾ Uruguay</option>
                        <option value="Uzbekistan" {{ "selected" if country == "Uzbekistan" else "" }}>ğŸ‡ºğŸ‡¿ Uzbekistan</option>
                        <option value="Vanuatu" {{ "selected" if country == "Vanuatu" else "" }}>ğŸ‡»ğŸ‡º Vanuatu</option>
                        <option value="Vatican City" {{ "selected" if country == "Vatican City" else "" }}>ğŸ‡»ğŸ‡¦ Vatican City</option>
                        <option value="Venezuela" {{ "selected" if country == "Venezuela" else "" }}>ğŸ‡»ğŸ‡ª Venezuela</option>
                        <option value="Vietnam" {{ "selected" if country == "Vietnam" else "" }}>ğŸ‡»ğŸ‡³ Vietnam</option>
                        <option value="Yemen" {{ "selected" if country == "Yemen" else "" }}>ğŸ‡¾ğŸ‡ª Yemen</option>
                        <option value="Zambia" {{ "selected" if country == "Zambia" else "" }}>ğŸ‡¿ğŸ‡² Zambia</option>
                        <option value="Zimbabwe" {{ "selected" if country == "Zimbabwe" else "" }}>ğŸ‡¿ğŸ‡¼ Zimbabwe</option>
                        <!-- Disputed & Partially Recognized Territories -->
                        <option value="Kosovo" {{ "selected" if country == "Afghanistan" else "" }}>ğŸ‡½ğŸ‡° Kosovo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="video_url">YouTube video URL:</label>
                    <input type="url" id="video_url" name="video_url" value="{{ video_url }}" required>
                </div>

                <div class="form-group">
                    <button type="submit" name="fetch_data" id="fetchDataButton">Fetch data</button>
                </div>
            </form>

            <h3>{{ message }}</h3>

            {% if existing_data %}
            <!-- Form for submitting additional data -->
            <form method="POST">
                <input type="hidden" name="city" value="{{ city }}">
                <input type="hidden" name="country" value="{{ country }}">
                <input type="hidden" name="video_url" value="{{ video_url }}">

                <div class="form-group">
                    <label for="time_of_day">Time of day:</label>
                    <select id="time_of_day" name="time_of_day">
                        <option value="0">0 (day)</option>
                        <option value="1">1 (night)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="vehicle_type">Vehicle:</label>
                    <select id="vehicle_type" name="vehicle_type">
                        <option value="0">0 (car)</option>
                        <option value="1">1 (bus)</option>
                        <option value="2">2 (truck)</option>
                        <option value="3">3 (two-wheeler)</option>
                        <option value="4">4 (bicycle)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="start_time">Start time (seconds):</label>
                    <input type="text" id="start_time" name="start_time" required type="number">
                </div>
                <div class="form-group">
                    <label for="end_time">End time (seconds):</label>
                    <input type="text" id="end_time" name="end_time" required type="number">
                </div>
                <div class="form-group">
                    <label for="upload_date_video">Upload date:</label>
                    <input type="text" id="upload_date_video" name="upload_date_video" value="{{ upload_date_video }}" required>
                </div>
                <div class="form-group">
                    <label for="fps_video">FPS:</label>
                    <input type="text" id="fps_video" name="fps_video" value="{{ fps_video }}" required min="1" step="1" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="lat">Latitude:</label>
                    <input type="text" id="lat" name="lat" value="{{ existing_data['lat'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="lon">Longitude:</label>
                    <input type="text" id="lon" name="lon" value="{{ existing_data['lon'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="gmp">GDP city (billion USD):</label>
                    <input type="text" id="gmp" name="gmp" value="{{ existing_data['gmp'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="population_city">Population city:</label>
                    <input type="text" id="population_city" name="population_city" value="{{ existing_data['population_city'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="population_country">Population country:</label>
                    <input type="text" id="population_country" name="population_country" value="{{ existing_data['population_country'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="traffic_mortality">Traffic mortality:</label>
                    <input type="text" id="traffic_mortality" name="traffic_mortality" value="{{ existing_data['traffic_mortality'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="continent">Continent:</label>
                    <select id="continent" name="continent">
                        <option value="Africa" {% if existing_data['continent'] == 'Africa' %}selected{% endif %}>Africa</option>
                        <option value="Asia" {% if existing_data['continent'] == 'Asia' %}selected{% endif %}>Asia</option>
                        <option value="Europe" {% if existing_data['continent'] == 'Europe' %}selected{% endif %}>Europe</option>
                        <option value="South America" {% if existing_data['continent'] == 'South America' %}selected{% endif %}>South America</option>
                        <option value="North America" {% if existing_data['continent'] == 'North America' %}selected{% endif %}>North America</option>
                        <option value="Oceania" {% if existing_data['continent'] == 'Oceania' %}selected{% endif %}>Oceania</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="literacy_rate">Literacy rate:</label>
                    <input type="text" id="literacy_rate" name="literacy_rate" value="{{ existing_data['literacy_rate'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="avg_height">Average height:</label>
                    <input type="text" id="avg_height" name="avg_height" value="{{ existing_data['avg_height'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="gini">Gini index:</label>
                    <input type="text" id="gini" name="gini" value="{{ existing_data['gini'] }}" type="number" pattern="[0-9.]*">
                </div>
                <div class="form-group">
                    <label for="traffic_index">Traffic index:</label>
                    <input type="text" id="traffic_index" name="traffic_index" value="{{ existing_data['traffic_index'] }}" type="number" pattern="[0-9.]*">
                </div>

                <div class="form-group">
                    <button type="submit" name="submit_data">Submit</button>
                </div>
                <p class="videos-text"><strong>Videos:</strong> {{ existing_data['videos'] }}</p>
                <p class="videos-text"><strong>Time of day:</strong> {{ existing_data['time_of_day'] }}</p>
                <p class="videos-text"><strong>Vehicle:</strong> {{ existing_data['vehicle_type'] }}</p>
                <p class="videos-text"><strong>Start time:</strong> {{ existing_data['start_time'] }}</p>
                <p class="videos-text"><strong>End time:</strong> {{ existing_data['end_time'] }}</p>
                <p class="videos-text"><strong>Upload date:</strong> {{ existing_data['upload_date'] }}</p>
                <p class="videos-text"><strong>FPS list:</strong> {{ existing_data['fps_list'] }}</p>
            </form>
            {% endif %}
        </div>

        <div class="right">
            {% if video_id %}
                <!-- Embed the YouTube video only if a valid video ID is available -->
                <iframe id="embeddedVideo" src="https://www.youtube.com/embed/{{ video_id }}?start={{ timestamp }}&enablejsapi=1&autoplay=1&mute=1" frameborder="0" allowfullscreen allow="autoplay"></iframe>
                <p class="short_row">Current time: <span id="currentTime">0</span> s. <strong>ID:</strong> <span id="videoTitle">{{ video_id }}</span>. <strong>Upload date:</strong> <span id="videoUploadDate">{{ yt_upload_date }}</span>.</p>
                <p class="short_row"><strong>Start time</strong>: {{ start_time_video }}</p>
                <p class="short_row"><strong>End time</strong>: {{ end_time_video }}</p>
                <p class="short_row"><strong>Description:</strong> <span id="videoDescription">{{ yt_description }}</span></p>
                <!-- Map -->
                <div id="map"></div>
            {% endif %}
        </div>
    </div>
</body>
</html>